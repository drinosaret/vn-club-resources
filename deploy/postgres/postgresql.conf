# =============================================================================
# PostgreSQL tuning for VN Club
# =============================================================================
# Mounted read-only into the postgres container. Alpine defaults are far too

# ---------- Networking ----------
# Listen on all interfaces so other containers can connect.
listen_addresses = '*'

# ---------- Memory ----------
# 25% of 2GB container limit. The single most impactful setting.
shared_buffers = 512MB

# Per-operation sort/hash memory. Browse queries with multi-column sorts
# and stats aggregations benefit heavily from this over the 4MB default.
work_mem = 16MB

# For VACUUM, CREATE INDEX, etc. Only one runs at a time so can be generous.
maintenance_work_mem = 256MB

# Tell the planner how much OS cache is available (~75% of container RAM).
# Doesn't allocate anything, just improves query plan decisions.
effective_cache_size = 1536MB

# ---------- Connections ----------
# Pool is 30 + 50 overflow = 80 max. Leave headroom for admin/monitoring.
max_connections = 100

# ---------- WAL / Write Performance ----------
# Larger WAL buffers reduce disk flushes during writes (daily imports).
wal_buffers = 16MB

# Checkpoint tuning. Spread writes over longer intervals to avoid I/O spikes.
checkpoint_completion_target = 0.9
max_wal_size = 1GB
min_wal_size = 256MB

# ---------- Planner / Query Optimization ----------
# SSD storage. Sequential and random I/O cost nearly identical.
random_page_cost = 1.1
effective_io_concurrency = 200

# Default statistics target for ANALYZE. Higher = better plans for
# skewed distributions (tag scores, vote counts). Costs a bit more ANALYZE time.
default_statistics_target = 200

# ---------- Background Writer ----------
# More aggressive background writing keeps shared_buffers clean.
bgwriter_lru_maxpages = 100
bgwriter_lru_multiplier = 2.0

# ---------- Logging ----------
# Log slow queries for debugging (â‰¥500ms).
log_min_duration_statement = 500
